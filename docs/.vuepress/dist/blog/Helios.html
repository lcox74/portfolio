<!DOCTYPE html>
<html lang="en_AU">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Helios - Custom Windows Taskbar | Lachlan Cox</title>
    <meta name="generator" content="VuePress 1.8.0">
    
    <meta name="description" content="A quest to create my very own taskbar using the Win32 library, SDL and C++. Inspired by my friends project called Selene.">
    
    <link rel="preload" href="/assets/css/0.styles.5d6246ff.css" as="style"><link rel="preload" href="/assets/js/app.ae04084f.js" as="script"><link rel="preload" href="/assets/js/2.19186952.js" as="script"><link rel="preload" href="/assets/js/12.4b53c846.js" as="script"><link rel="preload" href="/assets/js/8.f748bd4c.js" as="script"><link rel="prefetch" href="/assets/js/10.486d4173.js"><link rel="prefetch" href="/assets/js/11.f920ddbe.js"><link rel="prefetch" href="/assets/js/13.f9fc4099.js"><link rel="prefetch" href="/assets/js/14.5c5da34f.js"><link rel="prefetch" href="/assets/js/15.3aeddcf0.js"><link rel="prefetch" href="/assets/js/3.71979686.js"><link rel="prefetch" href="/assets/js/4.4a826230.js"><link rel="prefetch" href="/assets/js/5.63daacbf.js"><link rel="prefetch" href="/assets/js/6.f5cdaab6.js"><link rel="prefetch" href="/assets/js/7.8782e2bc.js"><link rel="prefetch" href="/assets/js/9.228e5fa7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.5d6246ff.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">Lachlan Cox</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  Blog
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  Home
</a></div><div class="nav-item"><a href="/blog/" class="nav-link router-link-active">
  Blog
</a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>Helios - Custom Windows Taskbar</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog/Helios.html#_0x00-why-do-this-project" class="sidebar-link">0x00: Why do this project</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/Helios.html#_0x01-starting-this-project" class="sidebar-link">0x01: Starting this project</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/Helios.html#_0x02-registering-an-app-bar" class="sidebar-link">0x02: Registering an App Bar</a><ul class="sidebar-sub-headers"></ul></li><li><a href="/blog/Helios.html#_0x03-fetching-music" class="sidebar-link">0x03: Fetching music</a><ul class="sidebar-sub-headers"></ul></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="page-title"><a href="#page-title" class="header-anchor">#</a> Helios - Custom Windows Taskbar</h1> <blockquote><p>07-02-2021</p></blockquote> <p>This project was inspired by an existing project called <a href="https://github.com/JamesDearlove/Selene" target="_blank" rel="noopener noreferrer">Selene<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, something my friend <a href="https://jamesdearlove.com/" target="_blank" rel="noopener noreferrer">James Dearlove<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> was developing. James was developing Selene using .NET and utilising the Windows 10 Runtime API. Because of this Selene will only work for Windows 10 1809 (Build 17763) or newer.</p> <p>Because of this, and also because I really like C++, I had a thought... <code>What if Selene was C++ now</code> this thought lead me to delve into the depths of the Win32 API and regret starting this project.</p> <h2 id="_0x00-why-do-this-project"><a href="#_0x00-why-do-this-project" class="header-anchor">#</a> 0x00: Why do this project</h2> <p>When James started working on Selene I thought it looked absolutely amazing, the design was slick and with the right desktop background it made Windows look like something special. Yes you can do similar stuff with <a href="https://www.rainmeter.net/" target="_blank" rel="noopener noreferrer">Rainmeter<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> but James made this himself. If you didn't look at the <a href="https://github.com/JamesDearlove/Selene" target="_blank" rel="noopener noreferrer">Selene<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> repo, its essentially a thin bar at the top of your display with the middle section showing what song you are currently listening along with a pop out media controller. Other features included showing your battery level, time and some miscellaneous buttons all with clean looking glyphs.</p> <p><img src="/assets/img/selene_example.02dc4324.png" alt="Selene Example"></p> <h2 id="_0x01-starting-this-project"><a href="#_0x01-starting-this-project" class="header-anchor">#</a> 0x01: Starting this project</h2> <p>I started this project with a name, Helios. I picked this name as Selene is the Greek Goddess of the Moon while Helios is the Greek God of the Sun. James figured I would name it that. After naming it I was able to start an empty C++ Visual Studios Project. To be able to do this project, I needed to do 3 main things:</p> <ul><li>Something to render with</li> <li>Render fonts</li> <li>Register the window as a taskbar using the win32</li></ul> <p>For the renderer I decided to use a basic <a href="https://libsdl.org/index.php" target="_blank" rel="noopener noreferrer">SDL<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> setup. Create a window, Have a buffer to manually write to, push the buffer to the window. I will go over this more in my Greyhound project, I'm planning on integrating that into this when it gets more developed. For rendering fonts I did use the <a href="https://www.libsdl.org/projects/SDL_ttf/" target="_blank" rel="noopener noreferrer">SDL_TTF<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> library as it works nicely with SDL but I did have to write a reasource manager to handle using mutliple fonts at different sizes as I wanted to minimise the amount of times the program had to read a font file.</p> <p>Rendering the glyphs that James used in Selene had me stumpped for a while, as I thought it had something to do with the other font rendering calls avaliable with SDL_ttf like <code>TTF_RenderUTF8()</code>, <code>TTF_RenderUNICODE()</code>, <code>TTF_RenderGlyph()</code>. Turns out the glyphs that Microsoft uses for their stuff is its own font called <a href="https://docs.microsoft.com/en-us/windows/uwp/design/style/segoe-ui-symbol-font" target="_blank" rel="noopener noreferrer">Segoe MDL2<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> which if you have a windows machine you can find it in the <code>C:/Windows/Font</code> directory.</p> <p>Now that I have the main rendering part down pack all I need to do now is the hard part... reading the Microsoft Win32 API Documentation.</p> <h2 id="_0x02-registering-an-app-bar"><a href="#_0x02-registering-an-app-bar" class="header-anchor">#</a> 0x02: Registering an App Bar</h2> <p>This was relatively easy to do, but was incredibly painful to try and figure out. Alot of the documentation seemed to really want you to use C# these days and also the Runtime library which are both things I didn't want to use. The Runtime library is what made Selene stuck with the Windows 10 1809 (Build 17763) or newer limitation.</p> <p>I eventually caved in and looked at James' code to see what he did. He used an external library called <a href="https://github.com/PhilipRieck/WpfAppBar" target="_blank" rel="noopener noreferrer">WpfAppBar<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>, which after reading lead me to Windows Shellapi.h but more specifically the <a href="https://docs.microsoft.com/en-us/windows/win32/api/shellapi/nf-shellapi-shappbarmessage" target="_blank" rel="noopener noreferrer">SHAppBarMessage<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a> call.</p> <p>This was a great discovery for the project as all I have to do now is use <code>SHAppBarMessage()</code> to register an <code>appbar</code> then I would be able to set the position and size of it, though check to see if the space is ooccupied and if it is occupied then it would try and get the next best position). The checking space occupied thing explained why when you were able to run selene more than once they dont all go to the top but stack, but if you force them all to go to the top Windows will really bug out.</p> <p>Below is an the code required to register the <code>appbar</code> as well as another function to position and size it.</p> <div class="language-C extra-class"><pre class="language-c"><code><span class="token comment">// The application needs to be registered as an App Bar to be used like a seperate task bar</span>
bool <span class="token function">RegisterAppBar</span><span class="token punctuation">(</span>SDL_Window<span class="token operator">*</span> window<span class="token punctuation">,</span> bool register_state<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Set the windows message callback to an unreserved number</span>
    app_bar_callback <span class="token operator">=</span> <span class="token punctuation">(</span>WM_USER <span class="token operator">+</span> <span class="token number">0x01</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    data <span class="token operator">=</span> new <span class="token function">APPBARDATA</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Set basics of the appbar data</span>
    data<span class="token operator">-&gt;</span>cbSize <span class="token operator">=</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>APPBARDATA<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Set window handle</span>
    data<span class="token operator">-&gt;</span>hWnd <span class="token operator">=</span> <span class="token function">GetWindowHandle</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token operator">-&gt;</span>hWnd <span class="token operator">==</span> nullptr<span class="token punctuation">)</span> <span class="token keyword">return</span> false<span class="token punctuation">;</span>

    <span class="token comment">// Register the App Bar</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>register_state<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Set the App Bar&amp;#x27;s winows message callback</span>
        data<span class="token operator">-&gt;</span>uCallbackMessage <span class="token operator">=</span> app_bar_callback<span class="token punctuation">;</span>

        <span class="token comment">// Register the app bar, return false if it failed</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">SHAppBarMessage</span><span class="token punctuation">(</span>ABM_NEW<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span> false<span class="token punctuation">;</span>

        <span class="token comment">// Set stats</span>
        app_bar_registered <span class="token operator">=</span> true<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">else</span> <span class="token punctuation">{</span>
        <span class="token comment">// Un-Register the App Bar from the windows shell API</span>
        <span class="token function">SHAppBarMessage</span><span class="token punctuation">(</span>ABM_REMOVE<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>
        app_bar_registered <span class="token operator">=</span> false<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> true<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">// Set a registered App Bar to be fixed to a particular side of the screen</span>
<span class="token keyword">void</span> PASCAL <span class="token function">AppBarSetPos</span><span class="token punctuation">(</span>SDL_Window<span class="token operator">*</span> window<span class="token punctuation">,</span> <span class="token keyword">int</span> desired_size <span class="token operator">=</span> <span class="token number">30</span><span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Error Checking</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>app_bar_registered <span class="token operator">==</span> false<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span><span class="token function">RegisterAppBar</span><span class="token punctuation">(</span>window<span class="token punctuation">,</span> true<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    data<span class="token operator">-&gt;</span>rc <span class="token operator">=</span> size<span class="token punctuation">;</span>
    data<span class="token operator">-&gt;</span>uEdge <span class="token operator">=</span> ABE_TOP<span class="token punctuation">;</span>
    
    <span class="token comment">// Set window handle</span>
    data<span class="token operator">-&gt;</span>hWnd <span class="token operator">=</span> <span class="token function">GetWindowHandle</span><span class="token punctuation">(</span>window<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>data<span class="token operator">-&gt;</span>hWnd <span class="token operator">==</span> nullptr<span class="token punctuation">)</span> <span class="token keyword">return</span><span class="token punctuation">;</span>

    <span class="token comment">// Set the window to the specific edge</span>
    height <span class="token operator">=</span> desired_size<span class="token punctuation">;</span>
    data<span class="token operator">-&gt;</span>rc<span class="token punctuation">.</span>left <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    data<span class="token operator">-&gt;</span>rc<span class="token punctuation">.</span>right <span class="token operator">=</span> <span class="token function">GetSystemMetrics</span><span class="token punctuation">(</span>SM_CXSCREEN<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Check if the size and position is valid</span>
    <span class="token function">SHAppBarMessage</span><span class="token punctuation">(</span>ABM_QUERYPOS<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Adjust window size to fit the appropriate edge</span>
    data<span class="token operator">-&gt;</span>rc<span class="token punctuation">.</span>bottom <span class="token operator">=</span> data<span class="token operator">-&gt;</span>rc<span class="token punctuation">.</span>top <span class="token operator">+</span> height<span class="token punctuation">;</span>

    <span class="token comment">// Check the window rect bound with the system</span>
    <span class="token function">SHAppBarMessage</span><span class="token punctuation">(</span>ABM_SETPOS<span class="token punctuation">,</span> data<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// Set the winow</span>
    <span class="token function">MoveWindow</span><span class="token punctuation">(</span>data<span class="token operator">-&gt;</span>hWnd<span class="token punctuation">,</span> data<span class="token operator">-&gt;</span>rc<span class="token punctuation">.</span>left<span class="token punctuation">,</span> 
                           data<span class="token operator">-&gt;</span>rc<span class="token punctuation">.</span>top<span class="token punctuation">,</span> 
                           data<span class="token operator">-&gt;</span>rc<span class="token punctuation">.</span>right <span class="token operator">-</span> data<span class="token operator">-&gt;</span>rc<span class="token punctuation">.</span>left<span class="token punctuation">,</span> 
                           data<span class="token operator">-&gt;</span>rc<span class="token punctuation">.</span>bottom <span class="token operator">-</span> data<span class="token operator">-&gt;</span>rc<span class="token punctuation">.</span>top<span class="token punctuation">,</span> true<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><h2 id="_0x03-fetching-music"><a href="#_0x03-fetching-music" class="header-anchor">#</a> 0x03: Fetching music</h2> <p>Now that I had the <code>appbar</code> registered and the window positioned where I wanted it, it was time to get the active music. James used the Runtime to get all active media which would have been amazing, but for Helios, Spotify will be its only location for music (for now). Spotify is very friendly and helps with this as the window name for spotify changes to the current playing song.</p> <p>So what I needed to do was to find the Spotify process and get the window name. I had to go through multiple different iterations of process searching because of a lot of memory leak issues, at one point I was using +100MB of memory every couple of seconds. But it's now fixed and works smoothly. Below is the code I used:</p> <div class="language-C extra-class"><pre class="language-c"><code><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> current_search<span class="token punctuation">;</span>

<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> Helios<span class="token operator">::</span>Process<span class="token operator">::</span><span class="token function">GetWindowNameByProcessName</span><span class="token punctuation">(</span><span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> name<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Set the process to search</span>
    current_search <span class="token operator">=</span> name<span class="token punctuation">;</span>

    <span class="token comment">// Get the window handle for the target process</span>
    HWND desired_hWnd <span class="token operator">=</span> nullptr<span class="token punctuation">;</span>
    bool search <span class="token operator">=</span> <span class="token function">EnumWindows</span><span class="token punctuation">(</span>EnumWindowCallback<span class="token punctuation">,</span> <span class="token punctuation">(</span>LPARAM<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>desired_hWnd<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>search<span class="token punctuation">)</span> <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>

    <span class="token comment">// Get the window title from the window handle</span>
    <span class="token keyword">int</span> length <span class="token operator">=</span> <span class="token function">GetWindowTextLength</span><span class="token punctuation">(</span>desired_hWnd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">char</span><span class="token operator">*</span> buffer <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token keyword">char</span><span class="token operator">*</span><span class="token punctuation">)</span><span class="token function">malloc</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token operator">++</span>length<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span><span class="token keyword">char</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">GetWindowTextA</span><span class="token punctuation">(</span>desired_hWnd<span class="token punctuation">,</span> buffer<span class="token punctuation">,</span> length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    
    <span class="token comment">// Return the window name</span>
    <span class="token keyword">return</span> buffer<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

BOOL Helios<span class="token operator">::</span>Process<span class="token operator">::</span><span class="token function">EnumWindowCallback</span><span class="token punctuation">(</span>HWND hWnd<span class="token punctuation">,</span> LPARAM lparam<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Cull processes that are definetly not the target</span>
    <span class="token keyword">int</span> length <span class="token operator">=</span> <span class="token function">GetWindowTextLength</span><span class="token punctuation">(</span>hWnd<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">IsWindowVisible</span><span class="token punctuation">(</span>hWnd<span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> length <span class="token operator">!=</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Get the process ID</span>
        DWORD pid<span class="token punctuation">;</span>
        DWORD actual_proc_id <span class="token operator">=</span> <span class="token function">GetWindowThreadProcessId</span><span class="token punctuation">(</span>hWnd<span class="token punctuation">,</span> <span class="token operator">&amp;</span>pid<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// Check if the process name is the target process</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">strstr</span><span class="token punctuation">(</span><span class="token function">ProcessIdToName</span><span class="token punctuation">(</span>pid<span class="token punctuation">)</span><span class="token punctuation">,</span> current_search<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token comment">// Pass a reference back through the LPARAM and terminate the search</span>
            <span class="token comment">// to save on compute cycles</span>
            <span class="token operator">*</span><span class="token punctuation">(</span><span class="token punctuation">(</span>HWND<span class="token operator">*</span><span class="token punctuation">)</span><span class="token punctuation">(</span>lparam<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">=</span> hWnd<span class="token punctuation">;</span>
            <span class="token keyword">return</span> FALSE<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    
    <span class="token comment">// Continue search</span>
    <span class="token keyword">return</span> TRUE<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">const</span> <span class="token keyword">char</span><span class="token operator">*</span> Helios<span class="token operator">::</span>Process<span class="token operator">::</span><span class="token function">ProcessIdToName</span><span class="token punctuation">(</span>DWORD pid<span class="token punctuation">)</span>
<span class="token punctuation">{</span>
    <span class="token comment">// Get a handle for the process to read</span>
    CHAR process_name<span class="token punctuation">[</span>MAX_PATH<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">;</span>
    HANDLE handle <span class="token operator">=</span> <span class="token function">OpenProcess</span><span class="token punctuation">(</span>PROCESS_QUERY_INFORMATION <span class="token operator">|</span> PROCESS_VM_READ<span class="token punctuation">,</span> FALSE<span class="token punctuation">,</span> pid<span class="token punctuation">)</span><span class="token punctuation">;</span>

    HMODULE module_handle<span class="token punctuation">;</span>
    DWORD required_bytes_to_store_lphModule<span class="token punctuation">;</span>

    <span class="token comment">// Check if process handle was created</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token constant">NULL</span> <span class="token operator">!=</span> handle<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token comment">// Get the module handles, check if it failed</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token function">EnumProcessModules</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> <span class="token operator">&amp;</span>module_handle<span class="token punctuation">,</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>module_handle<span class="token punctuation">)</span><span class="token punctuation">,</span> 
                               <span class="token operator">&amp;</span>required_bytes_to_store_lphModule<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>

            <span class="token comment">// Get the process name</span>
            <span class="token function">GetModuleBaseNameA</span><span class="token punctuation">(</span>handle<span class="token punctuation">,</span> module_handle<span class="token punctuation">,</span> process_name<span class="token punctuation">,</span> 
                               <span class="token keyword">sizeof</span><span class="token punctuation">(</span>process_name<span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token keyword">sizeof</span><span class="token punctuation">(</span>CHAR<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// Close handle to prevent leak</span>
    <span class="token function">CloseHandle</span><span class="token punctuation">(</span>handle<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">return</span> process_name<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>For an explanation I had to use the <code>winuser.h</code> library to to get all the top-level windows on the screen, convert the <code>PIDs</code> (Process Ids) to the process name using <code>psapi.h</code> to search for the window with the target process which returned the <code>HWND</code> which allowed me to use <code>GetWindowTextA()</code> to get the window name.</p> <footer data-v-9c7f4b82>
    Copyright © Lachlan Cox 2020.
</footer></div> <footer class="page-edit"><!----> <!----></footer> <!----> </main></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.ae04084f.js" defer></script><script src="/assets/js/2.19186952.js" defer></script><script src="/assets/js/12.4b53c846.js" defer></script><script src="/assets/js/8.f748bd4c.js" defer></script>
  </body>
</html>
